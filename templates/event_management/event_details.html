{% extends 'base.html' %}
{% load static %}
{% load document_templatetags %}
{% block content %}

    <script src="{% static 'js/SiteScripts/search_results.js' %}"></script>
    <script src="/static/js/task_manager.js"></script>

    <style>
        th {
            white-space: normal !important;
            word-wrap: break-word !important;
            font-size: 14px;
            vertical-align: middle;
        }
        td {
            word-wrap: break-word;
            font-size: 14px;
            vertical-align: middle;
        }
    </style>

    {% if success %}
        <script>
            alert("Event E00000{{ event.id }} has been modified successfully");
            window.opener.location.reload();
            window.close();
        </script>
    {% endif %}

    {% if error %}
        <script>
            alert("ERROR! Please insert valid data");
            window.opener.location.reload();
            window.close();
        </script>
    {% endif %}

    <div>

        {% if event %}
            <h3 style="text-align: center; padding-top: 1%">Event Details</h3>
         <div>
             <div style="margin: 1%">
                <table class="table table-hover table-bordered table-light" style="table-layout: fixed; width: 60%; margin: 0 auto;">
                    <tr>
                        <td>
                            <b>Event ID:</b><br>
                            E-00000{{ event.id }}-{{ event.uploaded_date.year }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Unit:</b><br>
                            {{ event.get_unit_display }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Facility:</b><br>
                            {{ event.facility }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Elevation:</b><br>
                            {{ event.elevation }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Room No:</b><br>
                            {{ event.room_no }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Additional Location Information:</b><br>
                            {{ event.additional_location_info }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Event Date-Time:</b><br>
                            {{ event.event_date }}, {{ event.event_time }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Event Category:</b><br>
                            {{ event.get_event_category_display }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Description:</b><br>
                            {{ event.description }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Registration Date:</b><br>
                            {{ event.uploaded_date }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Regulatory Norms Violation:</b><br>
                            {{ event.regulatory_norms_violation }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Direct Cause:</b><br>
                            {{ event.direct_cause }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Action Taken:</b><br>
                            {{ event.action_taken }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Action to Prevent Recurrence Event:</b><br>
                            {{ event.action_to_prevent_recurrence_event }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Elimination Suggestion:</b><br>
                            {{ event.elimination_suggestion }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Responsible Department:</b><br>
                            {{ event.responsible_dept }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Plant Status:</b><br>
                            {{ event.plant_status }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Identity Confidentiality</b><br>
                            {% if event.keep_identity_confidential %} <span style="color:red">Yes</span> {% else %} No {% endif %}
                        </td>
                    </tr>
                    {% if event.keep_identity_confidential %}
                        <tr>
                            <td>
                                <b>Reporter:</b><br>
                                NA
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <b>Reporter Shop:</b><br>
                                NA
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <b>Reporter Organization:</b><br>
                                NA
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <b>Reporter Designation:</b><br>
                                NA
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <b>Reporter Phone:</b><br>
                                NA
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <b>Reporter Bio ID:</b><br>
                                NA
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td>
                                <b>Reporter:</b><br>
                                {{ event.uploaded_by }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <b>Reporter Shop:</b><br>
                                {{ event.uploader_shop }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <b>Reporter Organization</b><br>
                                {{ event.uploader_organization }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <b>Reporter Designation</b><br>
                                {{ event.uploader_designation }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <b>Reporter Phone:</b><br>
                                {{ event.uploader_phone }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <b>Reporter Bio ID:</b><br>
                                {{ event.uploader_bioID }}
                            </td>
                        </tr>
                    {% endif %}
                    <tr>
                        <td>
                            <b>Information Source:</b><br>
                            {{ event.information_source }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Supporting Files:</b><br>
                            {% if event.supporting_file_1 %}
                                1. <a href="{% url 'event_view' 'view' event.id 1 %}" target="_blank">{{ event.supporting_file_1.name|file_basename }}</a><br>
                            {% endif %}
                            {% if event.supporting_file_2 %}
                                2. <a href="{% url 'event_view' 'view' event.id 2 %}" target="_blank">{{ event.supporting_file_2.name|file_basename }}</a><br>
                            {% endif %}
                            {% if event.supporting_file_3 %}
                                <a href="{% url 'event_view' 'view' event.id 3 %}" target="_blank">{{ event.supporting_file_3.name|file_basename }}</a><br>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Assigned Supervisors:</b><br>
                            {% for each in event.supervisor_list %}
                                {{ each.first_name }} {{ each.last_name }}
                                ({{ each.username }})<br>
                            {% endfor %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Assigned Executors:</b><br>
                            {% for each in event.executor_list %}
                                {{ each.first_name }} {{ each.last_name }}
                                ({{ each.username }})<br>
                            {% endfor %}
                        </td>
                    </tr>

                    {% if event.resolution_status %}
                        <tr>
                            <td>
                                <b>Event Resolution Status:</b><br>
                                <span style="color: green; font-weight: bold">{{ event.get_resolution_status_display }}</span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <b>Resolved by:</b><br>
                                {{ event.resolved_by }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <b>Resolved Date</b>:</b><br>
                                {{ event.resolved_date }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <b>Resolver Remarks:</b><br>
                                {{ event.resolver_remarks }}
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td>
                                <b>Event Resolution Status:</b><br>
                                Not yet Approved
                            </td>
                        </tr>
                    {% endif %}

                <br><br>

                    <tr>
                        <td style="text-align: center">
                            <a style="margin: 1%; float: right" href="/event/approval/{{ event.id }}?action=approve" class="btn btn-success" target="_blank">Approve</a>
                            <a style="margin: 1%; float: right" href="/event/approval/{{ event.id }}?action=reject" class="btn btn-warning" target="_blank">Reject</a>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align: center">
                            <a style="margin: 1%; float: right" href="/event/edit/{{ event.id }}" class="btn btn-primary" target="_blank">Edit Event</a>
                            <a style="margin: 1%; float: right" href="/event/resolution/{{ event.id }}" class="btn btn-danger" target="_blank">Event Resolution</a>
                        </td>
                    </tr>

                </table>

                <div id="pagination_div">
                    {% if event_list.has_other_pages %}
                        <ul class="paginator">

                            <span>Page: </span>
                            {% for i in event_list.paginator.page_range %}
                                {% if doc_list.number == i %}
                                    <span class="this-page">{{ i }} <span
                                            class="sr-only">(current)</span></span>
                                {% else %}
                                    <a href="javascript:next_page_report('{{ i }}')">{{ i }}</a>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    {% endif %}
                 </div>
             </div>
         </div>

        {% else %}
            <h2 style="text-align:center; color:red">No Event Available</h2>
        {% endif %}

        <br> <br>
    </div>

{% endblock %}